"use strict";(globalThis.webpackChunkgodot_iap_docs=globalThis.webpackChunkgodot_iap_docs||[]).push([[653],{5159(e,r,n){n.d(r,{A:()=>a});n(6540);var o=n(6025),i=n(7856),s=n(4848);function a({title:e}){const r=(0,o.Ay)("/img/iapkit-banner.gif"),n=()=>{fetch(i.I,{method:"POST"}).catch(()=>{})};return(0,s.jsxs)("div",{style:{flex:1,marginTop:24,marginBottom:24},children:[(0,s.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:n,children:(0,s.jsx)("img",{src:r,alt:"IAPKit - In-App Purchase Solution",style:{display:"block",margin:"0 auto",objectFit:"contain"}})}),e?(0,s.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:n,style:{display:"block",fontSize:"0.875rem",color:"#666",textAlign:"center",marginTop:"8px",textDecoration:"none"},children:e}):null]})}},7856(e,r,n){n.d(r,{I:()=>i,V:()=>o});const o="https://iapkit.com",i="https://www.hyo.dev/api/ad-banner/cmju2uzzm0000yr9h3dhpflgy"},8453(e,r,n){n.d(r,{R:()=>a,x:()=>t});var o=n(6540);const i={},s=o.createContext(i);function a(e){const r=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(s.Provider,{value:r},e.children)}},9624(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"guides/error-handling","title":"Error Handling","description":"This guide covers best practices for handling errors in your GodotIap implementation.","source":"@site/docs/guides/error-handling.md","sourceDirName":"guides","slug":"/guides/error-handling","permalink":"/godot-iap/guides/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/godot-iap/tree/main/docs/docs/guides/error-handling.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Error Handling","sidebar_label":"Error Handling","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Subscription Offers","permalink":"/godot-iap/guides/subscription-offers"},"next":{"title":"Troubleshooting","permalink":"/godot-iap/guides/troubleshooting"}}');var i=n(4848),s=n(8453),a=n(5159);const t={title:"Error Handling",sidebar_label:"Error Handling",sidebar_position:3},c="Error Handling",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Error Structure",id:"error-structure",level:2},{value:"Common Error Codes",id:"common-error-codes",level:2},{value:"Basic Error Handling",id:"basic-error-handling",level:2},{value:"Error Recovery Strategies",id:"error-recovery-strategies",level:2},{value:"Retry Logic",id:"retry-logic",level:3},{value:"Graceful Degradation",id:"graceful-degradation",level:3},{value:"Platform-Specific Error Handling",id:"platform-specific-error-handling",level:2},{value:"iOS-Specific Errors",id:"ios-specific-errors",level:3},{value:"Android-Specific Errors",id:"android-specific-errors",level:3},{value:"User-Friendly Messages",id:"user-friendly-messages",level:2},{value:"Logging and Analytics",id:"logging-and-analytics",level:2},{value:"Complete Error Handler",id:"complete-error-handler",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Handle Errors",id:"1-always-handle-errors",level:3},{value:"2. Don&#39;t Expose Technical Details",id:"2-dont-expose-technical-details",level:3},{value:"3. Handle Platform Differences",id:"3-handle-platform-differences",level:3},{value:"See Also",id:"see-also",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"error-handling",children:"Error Handling"})}),"\n",(0,i.jsx)(a.A,{}),"\n",(0,i.jsx)(r.p,{children:"This guide covers best practices for handling errors in your GodotIap implementation."}),"\n",(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(r.p,{children:"GodotIap provides comprehensive error handling through standardized error codes and messages. All errors are returned as structured dictionaries with consistent properties across iOS and Android platforms."}),"\n",(0,i.jsx)(r.h2,{id:"error-structure",children:"Error Structure"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'# Error Dictionary Structure\n{\n    "code": "USER_CANCELED",\n    "message": "User cancelled the purchase",\n    "debugMessage": "Additional debug information",  # Optional\n    "domain": "SKErrorDomain"  # iOS only\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"common-error-codes",children:"Common Error Codes"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Code"}),(0,i.jsx)(r.th,{children:"Description"}),(0,i.jsx)(r.th,{children:"Recommended Action"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"USER_CANCELED"})}),(0,i.jsx)(r.td,{children:"User cancelled purchase"}),(0,i.jsx)(r.td,{children:"No action needed"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"NETWORK_ERROR"})}),(0,i.jsx)(r.td,{children:"Network connectivity issue"}),(0,i.jsx)(r.td,{children:"Show retry option"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ITEM_UNAVAILABLE"})}),(0,i.jsx)(r.td,{children:"Product not available"}),(0,i.jsx)(r.td,{children:"Check product setup"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ITEM_ALREADY_OWNED"})}),(0,i.jsx)(r.td,{children:"User already owns product"}),(0,i.jsx)(r.td,{children:"Restore purchase"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ITEM_NOT_OWNED"})}),(0,i.jsx)(r.td,{children:"Item not owned (consume/acknowledge)"}),(0,i.jsx)(r.td,{children:"Check purchase status"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"PAYMENT_INVALID"})}),(0,i.jsx)(r.td,{children:"Payment information invalid"}),(0,i.jsx)(r.td,{children:"Direct to payment settings"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"PAYMENT_NOT_ALLOWED"})}),(0,i.jsx)(r.td,{children:"Payments disabled on device"}),(0,i.jsx)(r.td,{children:"Show message"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"BILLING_UNAVAILABLE"})}),(0,i.jsx)(r.td,{children:"Billing service unavailable"}),(0,i.jsx)(r.td,{children:"Show retry option"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"DEVELOPER_ERROR"})}),(0,i.jsx)(r.td,{children:"Configuration error"}),(0,i.jsx)(r.td,{children:"Check setup"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"UNKNOWN"})}),(0,i.jsx)(r.td,{children:"Unknown error"}),(0,i.jsx)(r.td,{children:"Log for investigation"})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"basic-error-handling",children:"Basic Error Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'extends Node\n\nvar iap: GodotIap\n\nfunc _ready():\n    if Engine.has_singleton("GodotIap"):\n        iap = Engine.get_singleton("GodotIap")\n        iap.purchase_error.connect(_on_purchase_error)\n\nfunc _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n    var message = error.get("message", "")\n\n    match code:\n        "USER_CANCELED":\n            # User cancelled - no action needed\n            print("Purchase cancelled by user")\n\n        "NETWORK_ERROR":\n            # Network issue - offer retry\n            show_error_with_retry("Network error. Please check your connection.")\n\n        "ITEM_UNAVAILABLE":\n            # Product not available\n            show_error("This product is currently unavailable.")\n\n        "ITEM_ALREADY_OWNED":\n            # User already owns this\n            show_error("You already own this product.")\n            restore_purchases()\n\n        "PAYMENT_INVALID":\n            # Payment method issue\n            show_error("Payment was invalid. Please check your payment method.")\n\n        "PAYMENT_NOT_ALLOWED":\n            # Payments disabled\n            show_error("Payments are not allowed on this device.")\n\n        "BILLING_UNAVAILABLE":\n            # Store unavailable\n            show_error("Store is temporarily unavailable. Please try again later.")\n\n        _:\n            # Generic error\n            show_error("Purchase failed: " + message)\n            log_error(error)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"error-recovery-strategies",children:"Error Recovery Strategies"}),"\n",(0,i.jsx)(r.h3,{id:"retry-logic",children:"Retry Logic"}),"\n",(0,i.jsx)(r.p,{children:"Implement exponential backoff for transient errors:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'var retry_count: int = 0\nvar max_retries: int = 3\n\nfunc purchase_with_retry(product_id: String):\n    retry_count = 0\n    _attempt_purchase(product_id)\n\nfunc _attempt_purchase(product_id: String):\n    var params = {"sku": product_id, "type": "inapp"}\n    iap.request_purchase(JSON.stringify(params))\n\nfunc _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    # Only retry on transient errors\n    if code in ["NETWORK_ERROR", "BILLING_UNAVAILABLE"]:\n        if retry_count < max_retries:\n            retry_count += 1\n            var delay = pow(2, retry_count)  # Exponential backoff\n            print("Retrying in %d seconds..." % delay)\n            await get_tree().create_timer(delay).timeout\n            _attempt_purchase(last_product_id)\n        else:\n            show_error("Purchase failed after multiple attempts. Please try again later.")\n    else:\n        # Non-retriable error\n        handle_error(error)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"graceful-degradation",children:"Graceful Degradation"}),"\n",(0,i.jsx)(r.p,{children:"Provide fallback experiences:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    match code:\n        "BILLING_UNAVAILABLE", "PAYMENT_NOT_ALLOWED":\n            # Redirect to alternative purchase method\n            show_web_purchase_option()\n\n        "ITEM_UNAVAILABLE":\n            # Show alternative products\n            show_alternative_products()\n\n        "ITEM_ALREADY_OWNED":\n            # Restore purchase\n            restore_purchases()\n\n        _:\n            show_generic_error(error)\n\nfunc show_web_purchase_option():\n    # Open web browser for purchase\n    OS.shell_open("https://your-store.com/purchase")\n'})}),"\n",(0,i.jsx)(r.h2,{id:"platform-specific-error-handling",children:"Platform-Specific Error Handling"}),"\n",(0,i.jsx)(r.h3,{id:"ios-specific-errors",children:"iOS-Specific Errors"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func handle_ios_error(error: Dictionary):\n    var code = error.get("code", "")\n    var domain = error.get("domain", "")\n\n    if domain == "SKErrorDomain":\n        match code:\n            "0":  # SKErrorUnknown\n                log_error("Unknown StoreKit error")\n            "1":  # SKErrorClientInvalid\n                show_error("This device is not allowed to make purchases")\n            "2":  # SKErrorPaymentCancelled\n                pass  # User cancelled\n            "3":  # SKErrorPaymentInvalid\n                show_error("Invalid payment information")\n            "4":  # SKErrorPaymentNotAllowed\n                show_error("Payments are not allowed on this device")\n            "5":  # SKErrorStoreProductNotAvailable\n                show_error("Product not available in your region")\n'})}),"\n",(0,i.jsx)(r.h3,{id:"android-specific-errors",children:"Android-Specific Errors"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func handle_android_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    match code:\n        "SERVICE_TIMEOUT":\n            show_error_with_retry("Connection timeout. Please try again.")\n\n        "FEATURE_NOT_SUPPORTED":\n            show_error("This feature is not supported on your device.")\n\n        "SERVICE_DISCONNECTED":\n            # Attempt to reconnect\n            reconnect_to_store()\n\n        "SERVICE_UNAVAILABLE":\n            show_error_with_retry("Store service unavailable. Please try again.")\n\n        "BILLING_UNAVAILABLE":\n            show_error("Google Play Billing is not available.")\n\n        "DEVELOPER_ERROR":\n            # Log for debugging\n            log_error(error)\n            show_error("Configuration error. Please contact support.")\n\nfunc reconnect_to_store():\n    # Re-initialize connection\n    var result = JSON.parse_string(iap.init_connection())\n    if result.get("success", false):\n        print("Reconnected to store")\n    else:\n        show_error("Failed to reconnect to store")\n'})}),"\n",(0,i.jsx)(r.h2,{id:"user-friendly-messages",children:"User-Friendly Messages"}),"\n",(0,i.jsx)(r.p,{children:"Convert technical errors to user-friendly messages:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func get_user_friendly_message(error: Dictionary) -> String:\n    var code = error.get("code", "")\n\n    match code:\n        "USER_CANCELED":\n            return ""  # Don\'t show message for user cancellation\n\n        "NETWORK_ERROR":\n            return "Please check your internet connection and try again."\n\n        "ITEM_UNAVAILABLE":\n            return "This item is currently unavailable. Please try again later."\n\n        "ITEM_ALREADY_OWNED":\n            return "You already own this item. Tap \'Restore Purchases\' to restore it."\n\n        "PAYMENT_INVALID":\n            return "There was an issue with your payment method. Please check your settings."\n\n        "PAYMENT_NOT_ALLOWED":\n            return "Purchases are not allowed on this device."\n\n        "BILLING_UNAVAILABLE":\n            return "The store is temporarily unavailable. Please try again later."\n\n        _:\n            return "Something went wrong. Please try again later."\n\nfunc show_error_if_needed(error: Dictionary):\n    var message = get_user_friendly_message(error)\n    if message != "":\n        show_error_dialog(message)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"logging-and-analytics",children:"Logging and Analytics"}),"\n",(0,i.jsx)(r.p,{children:"Track errors for debugging and analytics:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func log_error(error: Dictionary):\n    var log_data = {\n        "error_code": error.get("code", ""),\n        "error_message": error.get("message", ""),\n        "debug_message": error.get("debugMessage", ""),\n        "platform": OS.get_name(),\n        "timestamp": Time.get_unix_time_from_system()\n    }\n\n    # Log to console\n    print("IAP Error: ", JSON.stringify(log_data))\n\n    # Send to analytics service\n    send_to_analytics("iap_error", log_data)\n\nfunc send_to_analytics(event_name: String, data: Dictionary):\n    # Implement your analytics integration\n    # Example: Firebase, custom backend, etc.\n    pass\n'})}),"\n",(0,i.jsx)(r.h2,{id:"complete-error-handler",children:"Complete Error Handler"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'extends Node\n\nvar iap: GodotIap\nvar last_product_id: String = ""\nvar retry_count: int = 0\nconst MAX_RETRIES = 3\n\nsignal purchase_error_handled(error: Dictionary)\n\nfunc _ready():\n    if Engine.has_singleton("GodotIap"):\n        iap = Engine.get_singleton("GodotIap")\n        iap.purchase_error.connect(_on_purchase_error)\n\nfunc _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    # Log all errors\n    log_error(error)\n\n    # Handle based on error type\n    match code:\n        "USER_CANCELED":\n            # Silent - user intentionally cancelled\n            pass\n\n        "NETWORK_ERROR", "SERVICE_TIMEOUT", "SERVICE_UNAVAILABLE":\n            _handle_transient_error(error)\n\n        "ITEM_ALREADY_OWNED":\n            _handle_already_owned(error)\n\n        "BILLING_UNAVAILABLE", "PAYMENT_NOT_ALLOWED":\n            _handle_billing_unavailable(error)\n\n        "DEVELOPER_ERROR":\n            _handle_developer_error(error)\n\n        _:\n            _handle_generic_error(error)\n\n    purchase_error_handled.emit(error)\n\nfunc _handle_transient_error(error: Dictionary):\n    if retry_count < MAX_RETRIES:\n        retry_count += 1\n        show_retry_dialog(\n            "Connection issue",\n            "Please check your connection and try again.",\n            func(): _retry_purchase()\n        )\n    else:\n        show_error_dialog("Unable to complete purchase. Please try again later.")\n        retry_count = 0\n\nfunc _handle_already_owned(error: Dictionary):\n    show_info_dialog(\n        "Already Owned",\n        "You already own this item. Would you like to restore your purchases?",\n        func(): restore_purchases()\n    )\n\nfunc _handle_billing_unavailable(error: Dictionary):\n    show_error_dialog(\n        "Purchases are currently unavailable. Please try again later or visit our website."\n    )\n\nfunc _handle_developer_error(error: Dictionary):\n    # Don\'t expose technical details to user\n    push_error("IAP Developer Error: " + JSON.stringify(error))\n    show_error_dialog("An error occurred. Please contact support.")\n\nfunc _handle_generic_error(error: Dictionary):\n    var message = get_user_friendly_message(error)\n    if message != "":\n        show_error_dialog(message)\n\nfunc _retry_purchase():\n    if last_product_id != "":\n        var params = {"sku": last_product_id, "type": "inapp"}\n        iap.request_purchase(JSON.stringify(params))\n\n# Helper functions\nfunc show_error_dialog(message: String):\n    # Implement your dialog system\n    pass\n\nfunc show_info_dialog(title: String, message: String, confirm_callback: Callable):\n    # Implement your dialog system\n    pass\n\nfunc show_retry_dialog(title: String, message: String, retry_callback: Callable):\n    # Implement your dialog system\n    pass\n\nfunc restore_purchases():\n    var purchases = JSON.parse_string(iap.get_available_purchases())\n    for purchase in purchases:\n        # Process each purchase\n        pass\n\nfunc log_error(error: Dictionary):\n    print("IAP Error: ", JSON.stringify(error))\n\nfunc get_user_friendly_message(error: Dictionary) -> String:\n    var code = error.get("code", "")\n    match code:\n        "NETWORK_ERROR":\n            return "Please check your internet connection."\n        "ITEM_UNAVAILABLE":\n            return "This item is not available."\n        "PAYMENT_INVALID":\n            return "Payment method issue."\n        _:\n            return "Something went wrong."\n'})}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(r.h3,{id:"1-always-handle-errors",children:"1. Always Handle Errors"}),"\n",(0,i.jsx)(r.p,{children:"Never leave IAP operations without error handling:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'# Bad - no error handling\nfunc buy(product_id: String):\n    iap.request_purchase(JSON.stringify({"sku": product_id}))\n\n# Good - proper error handling\nfunc buy(product_id: String):\n    if not is_connected:\n        show_error("Store not connected")\n        return\n\n    last_product_id = product_id\n    var result = JSON.parse_string(\n        iap.request_purchase(JSON.stringify({"sku": product_id}))\n    )\n\n    if not result.get("success", false):\n        handle_immediate_error(result)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"2-dont-expose-technical-details",children:"2. Don't Expose Technical Details"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'# Bad - exposing technical error\nfunc _on_purchase_error(error: Dictionary):\n    show_error(error.get("debugMessage", ""))\n\n# Good - user-friendly message\nfunc _on_purchase_error(error: Dictionary):\n    var user_message = get_user_friendly_message(error)\n    if user_message != "":\n        show_error(user_message)\n\n    # Log technical details for debugging\n    log_error(error)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"3-handle-platform-differences",children:"3. Handle Platform Differences"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-gdscript",children:'func _on_purchase_error(error: Dictionary):\n    if OS.get_name() == "iOS":\n        handle_ios_error(error)\n    elif OS.get_name() == "Android":\n        handle_android_error(error)\n    else:\n        handle_generic_error(error)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"./troubleshooting",children:"Troubleshooting"})," - Common issues and solutions"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"../api/",children:"API Reference"})," - Detailed method documentation"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"./purchases",children:"Purchases Guide"})," - Purchase implementation"]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);