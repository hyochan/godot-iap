"use strict";(globalThis.webpackChunkgodot_iap_docs=globalThis.webpackChunkgodot_iap_docs||[]).push([[359],{5159(n,e,r){r.d(e,{A:()=>t});r(6540);var i=r(6025),s=r(7856),o=r(4848);function t({title:n}){const e=(0,i.Ay)("/img/iapkit-banner.gif"),r=()=>{fetch(s.I,{method:"POST"}).catch(()=>{})};return(0,o.jsxs)("div",{style:{flex:1,marginTop:24,marginBottom:24},children:[(0,o.jsx)("a",{href:s.V,target:"_blank",rel:"noopener noreferrer",onClick:r,children:(0,o.jsx)("img",{src:e,alt:"IAPKit - In-App Purchase Solution",style:{display:"block",margin:"0 auto",objectFit:"contain"}})}),n?(0,o.jsx)("a",{href:s.V,target:"_blank",rel:"noopener noreferrer",onClick:r,style:{display:"block",fontSize:"0.875rem",color:"#666",textAlign:"center",marginTop:"8px",textDecoration:"none"},children:n}):null]})}},7856(n,e,r){r.d(e,{I:()=>s,V:()=>i});const i="https://iapkit.com",s="https://www.hyo.dev/api/ad-banner/cmju2uzzm0000yr9h3dhpflgy"},8453(n,e,r){r.d(e,{R:()=>t,x:()=>a});var i=r(6540);const s={},o=i.createContext(s);function t(n){const e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),i.createElement(o.Provider,{value:e},n.children)}},8829(n,e,r){r.r(e),r.d(e,{assets:()=>f,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/subscription-offers","title":"Subscription Offers","description":"This guide explains how to handle subscription offers (pricing plans) when purchasing subscriptions on iOS and Android platforms.","source":"@site/docs/guides/subscription-offers.md","sourceDirName":"guides","slug":"/guides/subscription-offers","permalink":"/godot-iap/guides/subscription-offers","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/godot-iap/tree/main/docs/docs/guides/subscription-offers.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Subscription Offers","sidebar_label":"Subscription Offers","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Purchases","permalink":"/godot-iap/guides/purchases"},"next":{"title":"Error Handling","permalink":"/godot-iap/guides/error-handling"}}');var s=r(4848),o=r(8453),t=r(5159);const a={title:"Subscription Offers",sidebar_label:"Subscription Offers",sidebar_position:4},c="Subscription Offers",f={},d=[{value:"Overview",id:"overview",level:2},{value:"Platform Differences",id:"platform-differences",level:2},{value:"Android Subscription Offers",id:"android-subscription-offers",level:2},{value:"Required for Android Subscriptions",id:"required-for-android-subscriptions",level:3},{value:"Getting Offer Tokens",id:"getting-offer-tokens",level:3},{value:"Purchase with Offers",id:"purchase-with-offers",level:3},{value:"Understanding Offer Details",id:"understanding-offer-details",level:3},{value:"Selecting Specific Offers",id:"selecting-specific-offers",level:3},{value:"iOS Subscription Offers",id:"ios-subscription-offers",level:2},{value:"Base Plan (Default)",id:"base-plan-default",level:3},{value:"Introductory Offers",id:"introductory-offers",level:3},{value:"Promotional Offers (Optional)",id:"promotional-offers-optional",level:3},{value:"Getting Available Promotional Offers",id:"getting-available-promotional-offers",level:4},{value:"Applying Promotional Offers",id:"applying-promotional-offers",level:4},{value:"Cross-Platform Implementation",id:"cross-platform-implementation",level:2},{value:"Displaying Offer Information",id:"displaying-offer-information",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Android Errors",id:"android-errors",level:3},{value:"iOS Errors",id:"ios-errors",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function u(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"subscription-offers",children:"Subscription Offers"})}),"\n",(0,s.jsx)(t.A,{}),"\n",(0,s.jsx)(e.p,{children:"This guide explains how to handle subscription offers (pricing plans) when purchasing subscriptions on iOS and Android platforms."}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"Subscription offers represent different pricing plans for the same subscription product:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Base Plan"}),": The standard pricing for a subscription"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Introductory Offers"}),": Special pricing for new subscribers (free trial, discounted period)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Promotional Offers"}),": Limited-time discounts configured in the app stores"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"platform-differences",children:"Platform Differences"}),"\n",(0,s.jsx)(e.p,{children:"At a glance:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Android"}),": Subscription offers are required when purchasing subscriptions. You must pass ",(0,s.jsx)(e.code,{children:"offerToken"})," from ",(0,s.jsx)(e.code,{children:"fetch_subscriptions()"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"iOS"}),": Base plan is used by default. Promotional discounts are optional via ",(0,s.jsx)(e.code,{children:"withOffer"}),"."]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.p,{children:["Always fetch subscriptions first; offers only exist after ",(0,s.jsx)(e.code,{children:"fetch_subscriptions()"}),"."]})}),"\n",(0,s.jsx)(e.h2,{id:"android-subscription-offers",children:"Android Subscription Offers"}),"\n",(0,s.jsxs)(e.p,{children:["Android requires explicit specification of subscription offers when purchasing. Each offer is identified by an ",(0,s.jsx)(e.code,{children:"offerToken"})," obtained from ",(0,s.jsx)(e.code,{children:"fetch_subscriptions()"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"required-for-android-subscriptions",children:"Required for Android Subscriptions"}),"\n",(0,s.jsxs)(e.p,{children:["Unlike iOS, Android subscriptions ",(0,s.jsx)(e.strong,{children:"must"})," include ",(0,s.jsx)(e.code,{children:"offerToken"})," in the purchase request. Without it, the purchase may fail with:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-text",children:"The number of skus must match the number of offerTokens\n"})}),"\n",(0,s.jsx)(e.h3,{id:"getting-offer-tokens",children:"Getting Offer Tokens"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'var iap: GodotIap\nvar subscriptions: Array = []\n\nfunc _ready():\n    if Engine.has_singleton("GodotIap"):\n        iap = Engine.get_singleton("GodotIap")\n        iap.subscriptions_fetched.connect(_on_subscriptions_fetched)\n        _initialize()\n\nfunc _initialize():\n    var result = JSON.parse_string(iap.init_connection())\n    if result.get("success", false):\n        # Fetch subscriptions\n        var sub_ids = ["premium_monthly", "premium_yearly"]\n        iap.fetch_subscriptions(JSON.stringify(sub_ids))\n\nfunc _on_subscriptions_fetched(fetched_subs: Array):\n    subscriptions = fetched_subs\n\n    for sub in subscriptions:\n        print("Subscription: ", sub.productId)\n\n        # Access offer details (Android)\n        var offers = sub.get("subscriptionOfferDetailsAndroid", [])\n        for offer in offers:\n            print("  Offer Token: ", offer.offerToken)\n            print("  Base Plan ID: ", offer.basePlanId)\n            print("  Offer ID: ", offer.get("offerId", "Base Plan"))\n'})}),"\n",(0,s.jsx)(e.h3,{id:"purchase-with-offers",children:"Purchase with Offers"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func purchase_subscription(subscription_id: String):\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        print("Subscription not found")\n        return\n\n    var params = {\n        "sku": subscription_id,\n        "type": "subs"\n    }\n\n    # Android: Add offer token\n    if OS.get_name() == "Android":\n        var offers = subscription.get("subscriptionOfferDetailsAndroid", [])\n        if offers.size() > 0:\n            # Use the first available offer (base plan)\n            params["offerToken"] = offers[0].offerToken\n        else:\n            print("No subscription offers available")\n            return\n\n    iap.request_purchase(JSON.stringify(params))\n\nfunc _find_subscription(subscription_id: String) -> Dictionary:\n    for sub in subscriptions:\n        if sub.productId == subscription_id:\n            return sub\n    return {}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"understanding-offer-details",children:"Understanding Offer Details"}),"\n",(0,s.jsxs)(e.p,{children:["Each ",(0,s.jsx)(e.code,{children:"subscriptionOfferDetailsAndroid"})," item contains:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'# Android Subscription Offer Structure\n{\n    "basePlanId": "monthly-base",      # Base plan identifier\n    "offerId": "free-trial-7d",        # Offer identifier (null for base plan)\n    "offerTags": ["introductory"],     # Tags associated with the offer\n    "offerToken": "AEuhp4...",         # Token required for purchase\n    "pricingPhases": {\n        "pricingPhaseList": [\n            {\n                "billingPeriod": "P1M",\n                "formattedPrice": "$9.99",\n                "priceAmountMicros": 9990000,\n                "priceCurrencyCode": "USD",\n                "recurrenceMode": 1\n            }\n        ]\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"selecting-specific-offers",children:"Selecting Specific Offers"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func get_offers_for_subscription(subscription_id: String) -> Array:\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        return []\n\n    return subscription.get("subscriptionOfferDetailsAndroid", [])\n\nfunc get_base_plan_offer(subscription_id: String) -> Dictionary:\n    var offers = get_offers_for_subscription(subscription_id)\n    for offer in offers:\n        # Base plan has no offerId\n        if offer.get("offerId", null) == null:\n            return offer\n    return offers[0] if offers.size() > 0 else {}\n\nfunc get_introductory_offer(subscription_id: String) -> Dictionary:\n    var offers = get_offers_for_subscription(subscription_id)\n    for offer in offers:\n        var offer_id = offer.get("offerId", "")\n        if "intro" in offer_id or "trial" in offer_id:\n            return offer\n    return {}\n\nfunc purchase_with_specific_offer(subscription_id: String, offer_type: String):\n    var offer: Dictionary\n\n    match offer_type:\n        "base":\n            offer = get_base_plan_offer(subscription_id)\n        "introductory":\n            offer = get_introductory_offer(subscription_id)\n        _:\n            offer = get_base_plan_offer(subscription_id)\n\n    if offer.is_empty():\n        print("No suitable offer found")\n        return\n\n    var params = {\n        "sku": subscription_id,\n        "type": "subs",\n        "offerToken": offer.offerToken\n    }\n\n    iap.request_purchase(JSON.stringify(params))\n'})}),"\n",(0,s.jsx)(e.h2,{id:"ios-subscription-offers",children:"iOS Subscription Offers"}),"\n",(0,s.jsx)(e.p,{children:"iOS handles subscription offers differently - the base plan is used by default, and promotional offers are optional."}),"\n",(0,s.jsx)(e.h3,{id:"base-plan-default",children:"Base Plan (Default)"}),"\n",(0,s.jsx)(e.p,{children:"For standard subscription purchases, no special offer specification is needed:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func purchase_subscription_ios(subscription_id: String):\n    var params = {\n        "sku": subscription_id,\n        "type": "subs"\n    }\n    iap.request_purchase(JSON.stringify(params))\n'})}),"\n",(0,s.jsx)(e.h3,{id:"introductory-offers",children:"Introductory Offers"}),"\n",(0,s.jsx)(e.p,{children:"iOS automatically applies introductory prices (free trials, intro pricing) configured in App Store Connect. No additional code is needed - users will see the introductory offer when eligible."}),"\n",(0,s.jsx)(e.p,{children:"To check if a subscription has an introductory offer:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func check_introductory_offer(subscription_id: String):\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        return\n\n    var sub_info = subscription.get("subscriptionInfoIOS", {})\n    var intro_offer = sub_info.get("introductoryOffer", null)\n\n    if intro_offer:\n        var payment_mode = intro_offer.get("paymentMode", "")\n        var display_price = intro_offer.get("displayPrice", "")\n        var period = intro_offer.get("period", {})\n        var period_count = intro_offer.get("periodCount", 1)\n\n        match payment_mode:\n            "free-trial":\n                print("Free trial: %d %s(s)" % [period_count, period.get("unit", "day")])\n            "pay-as-you-go":\n                print("Intro price: %s for %d %s(s)" % [display_price, period_count, period.get("unit", "month")])\n            "pay-up-front":\n                print("Pay upfront: %s for first %d %s(s)" % [display_price, period_count, period.get("unit", "month")])\n    else:\n        print("No introductory offer available")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"promotional-offers-optional",children:"Promotional Offers (Optional)"}),"\n",(0,s.jsxs)(e.p,{children:["iOS supports promotional offers through the ",(0,s.jsx)(e.code,{children:"withOffer"})," parameter. These are server-to-server offers that require signature generation from your backend."]}),"\n",(0,s.jsx)(e.h4,{id:"getting-available-promotional-offers",children:"Getting Available Promotional Offers"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func get_promotional_offers(subscription_id: String) -> Array:\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        return []\n\n    var discounts = subscription.get("discountsIOS", [])\n\n    for discount in discounts:\n        print("Offer: ", discount.identifier)\n        print("  Price: ", discount.localizedPrice)\n        print("  Payment Mode: ", discount.paymentMode)\n        print("  Period: ", discount.subscriptionPeriod)\n        print("  Number of Periods: ", discount.numberOfPeriods)\n\n    return discounts\n'})}),"\n",(0,s.jsx)(e.h4,{id:"applying-promotional-offers",children:"Applying Promotional Offers"}),"\n",(0,s.jsx)(e.p,{children:"To apply a promotional offer, you need to generate a signature on your backend server:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func purchase_with_promotional_offer(subscription_id: String, offer_id: String):\n    # 1. Generate signature on your backend\n    var nonce = generate_uuid()\n    var timestamp = Time.get_unix_time_from_system() * 1000\n\n    var signature_data = await request_signature_from_server(\n        subscription_id,\n        offer_id,\n        nonce,\n        timestamp\n    )\n\n    # 2. Purchase with the promotional offer\n    var params = {\n        "sku": subscription_id,\n        "type": "subs",\n        "withOffer": {\n            "identifier": offer_id,\n            "keyIdentifier": signature_data.key_identifier,\n            "nonce": nonce,\n            "signature": signature_data.signature,\n            "timestamp": timestamp\n        }\n    }\n\n    iap.request_purchase(JSON.stringify(params))\n\nfunc request_signature_from_server(product_id: String, offer_id: String, nonce: String, timestamp: int) -> Dictionary:\n    var http = HTTPRequest.new()\n    add_child(http)\n\n    var body = JSON.stringify({\n        "productId": product_id,\n        "offerId": offer_id,\n        "nonce": nonce,\n        "timestamp": timestamp\n    })\n\n    http.request(\n        "https://your-backend.com/generate-offer-signature",\n        ["Content-Type: application/json"],\n        HTTPClient.METHOD_POST,\n        body\n    )\n\n    var result = await http.request_completed\n    http.queue_free()\n\n    var response = JSON.parse_string(result[3].get_string_from_utf8())\n    return response\n\nfunc generate_uuid() -> String:\n    # Generate a UUID v4 compliant string\n    # Format: xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\n    # where x is any hex digit and y is one of 8, 9, A, or B\n    var hex = "0123456789abcdef"\n    var uuid = ""\n    for i in range(36):\n        if i in [8, 13, 18, 23]:\n            uuid += "-"\n        elif i == 14:\n            uuid += "4"  # Version 4\n        elif i == 19:\n            uuid += hex[8 + (randi() % 4)]  # Variant: 8, 9, a, or b\n        else:\n            uuid += hex[randi() % 16]\n    return uuid\n'})}),"\n",(0,s.jsx)(e.h2,{id:"cross-platform-implementation",children:"Cross-Platform Implementation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'extends Node\n\nvar iap: GodotIap\nvar subscriptions: Array = []\n\nfunc _ready():\n    if Engine.has_singleton("GodotIap"):\n        iap = Engine.get_singleton("GodotIap")\n        iap.subscriptions_fetched.connect(_on_subscriptions_fetched)\n        iap.purchase_updated.connect(_on_purchase_updated)\n        iap.purchase_error.connect(_on_purchase_error)\n        _initialize()\n\nfunc _initialize():\n    var result = JSON.parse_string(iap.init_connection())\n    if result.get("success", false):\n        var sub_ids = ["premium_monthly", "premium_yearly"]\n        iap.fetch_subscriptions(JSON.stringify(sub_ids))\n\nfunc _on_subscriptions_fetched(fetched_subs: Array):\n    subscriptions = fetched_subs\n    update_subscription_ui()\n\nfunc purchase_subscription(subscription_id: String):\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        show_error("Subscription not found")\n        return\n\n    var params = {\n        "sku": subscription_id,\n        "type": "subs"\n    }\n\n    # Platform-specific handling\n    if OS.get_name() == "Android":\n        var offers = subscription.get("subscriptionOfferDetailsAndroid", [])\n        if offers.size() == 0:\n            show_error("No subscription offers available")\n            return\n\n        # Use first offer (or let user choose)\n        params["offerToken"] = offers[0].offerToken\n\n    elif OS.get_name() == "iOS":\n        # iOS: Base plan is used by default\n        # Add promotional offer if needed\n        pass\n\n    iap.request_purchase(JSON.stringify(params))\n\nfunc _on_purchase_updated(purchase: Dictionary):\n    var product_id = purchase.productId\n    var state = purchase.get("purchaseState", "")\n\n    if state == "purchased":\n        # Verify and grant subscription\n        await verify_and_grant_subscription(purchase)\n\nfunc _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n    match code:\n        "USER_CANCELED":\n            pass\n        _:\n            show_error(error.get("message", "Purchase failed"))\n\n# Helper functions\nfunc _find_subscription(subscription_id: String) -> Dictionary:\n    for sub in subscriptions:\n        if sub.productId == subscription_id:\n            return sub\n    return {}\n\nfunc get_subscription_price(subscription_id: String) -> String:\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        return "$9.99"\n\n    if OS.get_name() == "iOS":\n        return subscription.get("displayPrice", "$9.99")\n\n    elif OS.get_name() == "Android":\n        var offers = subscription.get("subscriptionOfferDetailsAndroid", [])\n        if offers.size() > 0:\n            var phases = offers[0].get("pricingPhases", {})\n            var phase_list = phases.get("pricingPhaseList", [])\n            if phase_list.size() > 0:\n                return phase_list[0].get("formattedPrice", "$9.99")\n\n    return "$9.99"\n\nfunc update_subscription_ui():\n    # Update your UI with subscription info\n    pass\n\nfunc verify_and_grant_subscription(purchase: Dictionary):\n    # Verify on server and grant access\n    pass\n\nfunc show_error(message: String):\n    # Show error dialog\n    pass\n'})}),"\n",(0,s.jsx)(e.h2,{id:"displaying-offer-information",children:"Displaying Offer Information"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func display_subscription_options(subscription_id: String):\n    var subscription = _find_subscription(subscription_id)\n    if not subscription:\n        return\n\n    print("=== %s ===" % subscription.get("title", subscription_id))\n\n    if OS.get_name() == "iOS":\n        # iOS: Show base price and intro offer if available\n        print("Price: ", subscription.get("displayPrice", ""))\n\n        var sub_info = subscription.get("subscriptionInfoIOS", {})\n        var intro = sub_info.get("introductoryOffer", null)\n        if intro:\n            print("Intro Offer: ", _format_ios_intro_offer(intro))\n\n        var discounts = subscription.get("discountsIOS", [])\n        for discount in discounts:\n            print("Promo: ", discount.identifier, " - ", discount.localizedPrice)\n\n    elif OS.get_name() == "Android":\n        # Android: Show each offer\n        var offers = subscription.get("subscriptionOfferDetailsAndroid", [])\n        for offer in offers:\n            var offer_name = offer.get("offerId", "Base Plan") if offer.get("offerId") else "Base Plan"\n            var phases = offer.get("pricingPhases", {}).get("pricingPhaseList", [])\n            if phases.size() > 0:\n                print("%s: %s" % [offer_name, phases[0].get("formattedPrice", "")])\n\nfunc _format_ios_intro_offer(intro: Dictionary) -> String:\n    var mode = intro.get("paymentMode", "")\n    var price = intro.get("displayPrice", "Free")\n    var count = intro.get("periodCount", 1)\n    var unit = intro.get("period", {}).get("unit", "day")\n\n    match mode:\n        "free-trial":\n            return "Free for %d %s(s)" % [count, unit]\n        "pay-as-you-go":\n            return "%s for %d %s(s)" % [price, count, unit]\n        "pay-up-front":\n            return "%s upfront for %d %s(s)" % [price, count, unit]\n        _:\n            return price\n'})}),"\n",(0,s.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(e.h3,{id:"android-errors",children:"Android Errors"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    if code == "PURCHASE_ERROR":\n        # Check if it\'s an offer-related error\n        var message = error.get("message", "")\n        if "offerToken" in message:\n            print("Subscription offer error - check offer token")\n            # Re-fetch subscriptions and try again\n            refetch_and_retry()\n'})}),"\n",(0,s.jsx)(e.h3,{id:"ios-errors",children:"iOS Errors"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gdscript",children:'func _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n\n    if code == "UNKNOWN":\n        var message = error.get("message", "")\n        if "signature" in message or "offer" in message:\n            print("Promotional offer error - check signature")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Always fetch subscriptions first"}),": Offers are only available after ",(0,s.jsx)(e.code,{children:"fetch_subscriptions()"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Handle platform differences"}),": Android requires offers, iOS makes them optional."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Validate offers exist"}),": Check that offers exist before attempting purchase."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"User selection"}),": Allow users to choose between different pricing plans when multiple offers are available."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Error recovery"}),": Provide fallback to base plan if selected offer fails."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Cache subscription data"}),": Avoid fetching subscriptions on every purchase attempt."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"./purchases",children:"Purchases Guide"})," - General purchase implementation"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"../api/",children:"API Reference"})," - Detailed method documentation"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"../api/methods/android-specific",children:"Android-Specific Methods"})," - Android billing details"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"../api/methods/ios-specific",children:"iOS-Specific Methods"})," - iOS StoreKit details"]}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}}}]);