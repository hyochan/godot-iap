"use strict";(globalThis.webpackChunkgodot_iap_docs=globalThis.webpackChunkgodot_iap_docs||[]).push([[183],{5159(n,e,s){s.d(e,{A:()=>t});s(6540);var r=s(6025),i=s(7856),c=s(4848);function t({title:n}){const e=(0,r.Ay)("/img/iapkit-banner.gif"),s=()=>{fetch(i.I,{method:"POST"}).catch(()=>{})};return(0,c.jsxs)("div",{style:{flex:1,marginTop:24,marginBottom:24},children:[(0,c.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:s,children:(0,c.jsx)("img",{src:e,alt:"IAPKit - In-App Purchase Solution",style:{display:"block",margin:"0 auto",objectFit:"contain"}})}),n?(0,c.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:s,style:{display:"block",fontSize:"0.875rem",color:"#666",textAlign:"center",marginTop:"8px",textDecoration:"none"},children:n}):null]})}},7856(n,e,s){s.d(e,{I:()=>i,V:()=>r});const r="https://iapkit.com",i="https://www.hyo.dev/api/ad-banner/cmju2uzzm0000yr9h3dhpflgy"},8453(n,e,s){s.d(e,{R:()=>t,x:()=>o});var r=s(6540);const i={},c=r.createContext(i);function t(n){const e=r.useContext(c);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),r.createElement(c.Provider,{value:e},n.children)}},9438(n,e,s){s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guides/lifecycle","title":"Lifecycle","description":"For complete understanding of the in-app purchase lifecycle, flow diagrams, and state management, please visit:","source":"@site/docs/guides/lifecycle.md","sourceDirName":"guides","slug":"/guides/lifecycle","permalink":"/godot-iap/guides/lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/godot-iap/tree/main/docs/docs/guides/lifecycle.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Lifecycle","sidebar_label":"Lifecycle","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Android Setup","permalink":"/godot-iap/getting-started/setup-android"},"next":{"title":"Purchases","permalink":"/godot-iap/guides/purchases"}}');var i=s(4848),c=s(8453),t=s(5159);const o={title:"Lifecycle",sidebar_label:"Lifecycle",sidebar_position:1},a="Lifecycle",d={},l=[{value:"Implementation with GodotIap",id:"implementation-with-godotiap",level:2},{value:"Connection Management",id:"connection-management",level:2},{value:"Connection States",id:"connection-states",level:3},{value:"Basic Connection Flow",id:"basic-connection-flow",level:3},{value:"Handling Connection States",id:"handling-connection-states",level:3},{value:"Component Lifecycle Integration",id:"component-lifecycle-integration",level:2},{value:"Scene Lifecycle",id:"scene-lifecycle",level:3},{value:"Autoload Pattern (Recommended)",id:"autoload-pattern-recommended",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Do",id:"do",level:3},{value:"Don&#39;t",id:"dont",level:3},{value:"Purchase Flow Best Practices",id:"purchase-flow-best-practices",level:2},{value:"Purchase Verification and Security",id:"purchase-verification-and-security",level:3},{value:"Purchase State Management",id:"purchase-state-management",level:3},{value:"Error Handling and User Experience",id:"error-handling-and-user-experience",level:3},{value:"Testing and Development",id:"testing-and-development",level:3},{value:"Common Pitfalls and Solutions",id:"common-pitfalls-and-solutions",level:2},{value:"Transaction Management Issues",id:"transaction-management-issues",level:3},{value:"Security Issues",id:"security-issues",level:3},{value:"App Lifecycle Issues",id:"app-lifecycle-issues",level:3},{value:"Connection Management Issues",id:"connection-management-issues",level:3},{value:"Next Steps",id:"next-steps",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"lifecycle",children:"Lifecycle"})}),"\n",(0,i.jsx)(t.A,{}),"\n",(0,i.jsx)(e.p,{children:"For complete understanding of the in-app purchase lifecycle, flow diagrams, and state management, please visit:"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:(0,i.jsx)(e.a,{href:"https://openiap.dev/docs/lifecycle",children:"Lifecycle Documentation - openiap.dev"})})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://openiap.dev/purchase-flow.png",alt:"Purchase Flow"})}),"\n",(0,i.jsx)(e.p,{children:"The Open IAP specification provides detailed documentation on:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Complete purchase flow"}),"\n",(0,i.jsx)(e.li,{children:"State transitions and management"}),"\n",(0,i.jsx)(e.li,{children:"Connection lifecycle"}),"\n",(0,i.jsx)(e.li,{children:"Error recovery patterns"}),"\n",(0,i.jsx)(e.li,{children:"Platform-specific considerations"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"implementation-with-godotiap",children:"Implementation with GodotIap"}),"\n",(0,i.jsx)(e.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,i.jsx)(e.p,{children:"Understanding the connection lifecycle is crucial for reliable IAP implementation."}),"\n",(0,i.jsx)(e.h3,{id:"connection-states",children:"Connection States"}),"\n",(0,i.jsx)(e.p,{children:"The connection can be in several states:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Disconnected"}),": Initial state, no connection to store"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Connecting"}),": Attempting to establish connection"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Connected"}),": Successfully connected, ready for operations"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Error"}),": Connection failed"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"basic-connection-flow",children:"Basic Connection Flow"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'extends Node\n\nconst Types = preload("res://addons/godot-iap/types.gd")\n\n@onready var iap = $GodotIapWrapper\n\nvar is_connected: bool = false\n\nfunc _ready():\n    _setup_signals()\n    _initialize_connection()\n\nfunc _setup_signals():\n    iap.purchase_updated.connect(_on_purchase_updated)\n    iap.purchase_error.connect(_on_purchase_error)\n    iap.products_fetched.connect(_on_products_fetched)\n    iap.connected.connect(_on_connected)\n\nfunc _initialize_connection():\n    # Returns bool - true if connection successful\n    is_connected = iap.init_connection()\n\n    if is_connected:\n        print("Connected to store")\n        _load_products()\n    else:\n        print("Failed to connect")\n        _on_connection_failed()\n\nfunc _load_products():\n    if is_connected:\n        var request = Types.ProductRequest.new()\n        var skus: Array[String] = ["coins_100", "premium"]\n        request.skus = skus\n        request.type = Types.ProductQueryType.ALL\n\n        var products = iap.fetch_products(request)\n        for product in products:\n            print("Product: ", product.id, " - ", product.display_price)\n\nfunc _on_connected():\n    is_connected = true\n    print("Store connected")\n'})}),"\n",(0,i.jsx)(e.h3,{id:"handling-connection-states",children:"Handling Connection States"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'var connection_error: String = ""\n\nfunc _initialize_connection():\n    is_connected = iap.init_connection()\n\n    if is_connected:\n        connection_error = ""\n        _on_connected_successfully()\n    else:\n        is_connected = false\n        connection_error = "Failed to connect to store"\n        _on_connection_failed()\n\nfunc _on_connected_successfully():\n    print("Store connected, loading products...")\n    _load_products()\n\nfunc _on_connection_failed():\n    print("Connection failed: ", connection_error)\n    # Show retry UI to user\n    show_retry_button()\n\nfunc retry_connection():\n    print("Retrying connection...")\n    _initialize_connection()\n'})}),"\n",(0,i.jsx)(e.h2,{id:"component-lifecycle-integration",children:"Component Lifecycle Integration"}),"\n",(0,i.jsx)(e.h3,{id:"scene-lifecycle",children:"Scene Lifecycle"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'extends Node\n\nconst Types = preload("res://addons/godot-iap/types.gd")\n\n@onready var iap = $GodotIapWrapper\n\nfunc _ready():\n    # Initialize IAP when scene loads\n    _setup_signals()\n    _initialize()\n\nfunc _exit_tree():\n    # Clean up when scene is removed\n    if iap:\n        # Disconnect signals if needed\n        if iap.purchase_updated.is_connected(_on_purchase_updated):\n            iap.purchase_updated.disconnect(_on_purchase_updated)\n        if iap.purchase_error.is_connected(_on_purchase_error):\n            iap.purchase_error.disconnect(_on_purchase_error)\n\n        # End connection\n        iap.end_connection()\n\nfunc _setup_signals():\n    iap.purchase_updated.connect(_on_purchase_updated)\n    iap.purchase_error.connect(_on_purchase_error)\n    iap.products_fetched.connect(_on_products_fetched)\n    iap.connected.connect(_on_connected)\n\nfunc _initialize():\n    if iap.init_connection():\n        _load_products()\n\nfunc _on_connected():\n    print("Store connected")\n\nfunc _on_purchase_updated(purchase: Dictionary):\n    # Handle purchase updates\n    pass\n\nfunc _on_purchase_error(error: Dictionary):\n    # Handle purchase errors\n    pass\n\nfunc _on_products_fetched(result: Dictionary):\n    # Handle fetched products\n    pass\n\nfunc _load_products():\n    var request = Types.ProductRequest.new()\n    var skus: Array[String] = ["coins_100", "premium"]\n    request.skus = skus\n    request.type = Types.ProductQueryType.ALL\n    iap.fetch_products(request)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"autoload-pattern-recommended",children:"Autoload Pattern (Recommended)"}),"\n",(0,i.jsx)(e.p,{children:"For persistent IAP management, use an Autoload singleton:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'# iap_manager.gd - Add this as an Autoload\nextends Node\n\nconst Types = preload("res://addons/godot-iap/types.gd")\n\n@onready var iap = $GodotIapWrapper\n\nvar is_connected: bool = false\nvar products: Array = []\nvar subscriptions: Array = []\n\nsignal iap_connected\nsignal iap_disconnected\nsignal iap_error(error: Dictionary)\nsignal products_loaded(products: Array)\nsignal purchase_completed(purchase: Dictionary)\nsignal purchase_failed(error: Dictionary)\n\nfunc _ready():\n    # Note: In Autoload, $GodotIapWrapper must be added as a child node\n    # Alternatively, create the node dynamically:\n    _setup_iap_node()\n    _setup_signals()\n    _initialize()\n\nfunc _setup_iap_node():\n    # If using Autoload, you need to add GodotIapWrapper as a child\n    var wrapper = preload("res://addons/godot-iap/godot_iap.gd").new()\n    wrapper.name = "GodotIapWrapper"\n    add_child(wrapper)\n    iap = wrapper\n\nfunc _setup_signals():\n    iap.purchase_updated.connect(_on_purchase_updated)\n    iap.purchase_error.connect(_on_purchase_error)\n    iap.products_fetched.connect(_on_products_fetched)\n    iap.connected.connect(_on_connected)\n    iap.disconnected.connect(_on_disconnected)\n\nfunc _initialize():\n    is_connected = iap.init_connection()\n    if is_connected:\n        iap_connected.emit()\n\nfunc _on_connected():\n    is_connected = true\n    iap_connected.emit()\n\nfunc _on_disconnected():\n    is_connected = false\n    iap_disconnected.emit()\n\nfunc _on_purchase_updated(purchase: Dictionary):\n    purchase_completed.emit(purchase)\n\nfunc _on_purchase_error(error: Dictionary):\n    purchase_failed.emit(error)\n\nfunc _on_products_fetched(result: Dictionary):\n    if result.has("products"):\n        products = result["products"]\n        products_loaded.emit(products)\n\n# Public API\nfunc load_products(product_ids: Array[String]):\n    if is_connected:\n        var request = Types.ProductRequest.new()\n        request.skus = product_ids\n        request.type = Types.ProductQueryType.ALL\n        products = iap.fetch_products(request)\n        products_loaded.emit(products)\n\nfunc load_subscriptions(sub_ids: Array[String]):\n    if is_connected:\n        var request = Types.ProductRequest.new()\n        request.skus = sub_ids\n        request.type = Types.ProductQueryType.SUBS\n        subscriptions = iap.fetch_products(request)\n\nfunc buy(product_id: String, type: Types.ProductQueryType = Types.ProductQueryType.IN_APP):\n    if not is_connected:\n        return\n\n    var props = Types.RequestPurchaseProps.new()\n    props.request = Types.RequestPurchasePropsByPlatforms.new()\n    props.type = type\n\n    props.request.google = Types.RequestPurchaseAndroidProps.new()\n    var skus: Array[String] = [product_id]\n    props.request.google.skus = skus\n\n    props.request.apple = Types.RequestPurchaseIOSProps.new()\n    props.request.apple.sku = product_id\n\n    iap.request_purchase(props)\n\nfunc restore() -> Array:\n    if is_connected:\n        return iap.get_available_purchases()\n    return []\n'})}),"\n",(0,i.jsx)(e.p,{children:"Usage in other scenes:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'# In any scene\nextends Control\n\nfunc _ready():\n    # Connect to the autoload signals\n    IapManager.products_loaded.connect(_on_products_loaded)\n    IapManager.purchase_completed.connect(_on_purchase_completed)\n\n    # Wait for connection\n    if IapManager.is_connected:\n        _load_store()\n    else:\n        IapManager.iap_connected.connect(_on_iap_connected)\n\nfunc _on_iap_connected():\n    _load_store()\n\nfunc _load_store():\n    var skus: Array[String] = ["coins_100", "premium"]\n    IapManager.load_products(skus)\n\nfunc _on_products_loaded(products: Array):\n    update_store_ui(products)\n\nfunc _on_purchase_completed(purchase: Dictionary):\n    handle_purchase(purchase)\n\nfunc update_store_ui(products: Array):\n    for product in products:\n        var id = product.id if product is Object else product.get("id", "")\n        var price = product.display_price if product is Object else product.get("displayPrice", "")\n        print("Product: ", id, " - ", price)\n\nfunc handle_purchase(purchase: Dictionary):\n    var product_id = purchase.get("productId", "")\n    # Grant purchase to user\n    pass\n'})}),"\n",(0,i.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(e.h3,{id:"do",children:"Do"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Initialize early"}),": Connect to store as early as possible in app lifecycle"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Handle connection states"}),": Provide feedback to users about connection status"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Use Autoload for persistence"}),": Keep IAP manager as singleton"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Clean up properly"}),": Always remove listeners and end connections"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Good: Using Autoload pattern\nfunc _ready():\n    if IapManager.is_connected:\n        load_store()\n"})}),"\n",(0,i.jsx)(e.h3,{id:"dont",children:"Don't"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Initialize repeatedly"}),": Don't call init_connection/end_connection for every operation"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Ignore connection state"}),": Don't attempt store operations when disconnected"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Forget cleanup"}),": Always clean up listeners to prevent issues"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Bad: Initializing for every operation\nfunc bad_purchase_flow(product_id: String):\n    iap.init_connection()  # Don't do this\n    buy_product(product_id)\n    iap.end_connection()   # Don't do this\n\n# Good: Use existing connection\nfunc good_purchase_flow(product_id: String):\n    if is_connected:\n        buy_product(product_id)\n"})}),"\n",(0,i.jsx)(e.h2,{id:"purchase-flow-best-practices",children:"Purchase Flow Best Practices"}),"\n",(0,i.jsx)(e.h3,{id:"purchase-verification-and-security",children:"Purchase Verification and Security"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Server-side verification recommended"}),": For production apps, verify purchases on your secure server before granting content."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Finish transactions after verification"}),": Always call ",(0,i.jsx)(e.code,{children:"finish_transaction"})," or ",(0,i.jsx)(e.code,{children:"finish_transaction_dict"})," after successfully verifying a purchase."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Never trust client-side data"}),": Always verify purchases server-side before granting premium content."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"purchase-state-management",children:"Purchase State Management"}),"\n",(0,i.jsxs)(e.ol,{start:"4",children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Handle all purchase states"}),": Including pending, failed, restored, and cancelled purchases."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Handle pending purchases"}),": Some purchases may require approval and remain in pending state."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Restore purchases properly"}),": Implement purchase restoration for non-consumable products and subscriptions."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"error-handling-and-user-experience",children:"Error Handling and User Experience"}),"\n",(0,i.jsxs)(e.ol,{start:"7",children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Implement comprehensive error handling"}),": Provide meaningful feedback for different error scenarios."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Graceful degradation"}),": Your app should work even if purchases fail."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"User feedback"}),": Keep users informed about purchase status."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"testing-and-development",children:"Testing and Development"}),"\n",(0,i.jsxs)(e.ol,{start:"10",children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test thoroughly"}),": Use real devices and official test accounts."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Monitor purchase flow"}),": Log important events for debugging."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"common-pitfalls-and-solutions",children:"Common Pitfalls and Solutions"}),"\n",(0,i.jsx)(e.h3,{id:"transaction-management-issues",children:"Transaction Management Issues"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Not finishing transactions:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Wrong - forgetting to finish transaction\nfunc handle_purchase(purchase: Dictionary):\n    var verified = await validate_receipt(purchase)\n    # Missing: finish_transaction call\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Always finish transactions after validation:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'# Correct - always finish transaction\nfunc handle_purchase(purchase: Dictionary):\n    var verified = await validate_receipt(purchase)\n    if verified:\n        grant_content(purchase.get("productId", ""))\n        var is_consumable = is_consumable_product(purchase.get("productId", ""))\n        var result = iap.finish_transaction_dict(purchase, is_consumable)\n        if result.success:\n            print("Transaction finished")\n'})}),"\n",(0,i.jsx)(e.h3,{id:"security-issues",children:"Security Issues"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Trusting client-side validation:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Wrong - never trust client-side validation alone\nfunc handle_purchase(purchase: Dictionary):\n    grant_premium_feature()  # Not secure\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Always validate server-side:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Correct - validate on secure server\nfunc handle_purchase(purchase: Dictionary):\n    var is_valid = await your_api.validate_receipt(purchase)\n    if is_valid:\n        grant_premium_feature()\n        finish_transaction(purchase)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"app-lifecycle-issues",children:"App Lifecycle Issues"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Not handling app restarts:"})}),"\n",(0,i.jsx)(e.p,{children:"Purchases can complete after app restart, so always check for pending purchases on launch:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Correct - check for purchases on app launch\nfunc _ready():\n    _setup_signals()\n    # After connection established\n    if iap.init_connection():\n        check_pending_purchases()\n\nfunc check_pending_purchases():\n    var purchases = iap.get_available_purchases()\n    for purchase in purchases:\n        await process_purchase(purchase)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"connection-management-issues",children:"Connection Management Issues"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Initializing connection repeatedly:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:"# Wrong - don't initialize for every operation\nfunc purchase_product(sku: String):\n    iap.init_connection()  # Don't do this\n    buy_product(sku)\n    iap.end_connection()   # Don't do this\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Maintain single connection:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-gdscript",children:'# Correct - use existing connection\nfunc purchase_product(sku: String):\n    if is_connected:\n        buy_product(sku)\n    else:\n        print("Store not connected")\n'})}),"\n",(0,i.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Review ",(0,i.jsx)(e.a,{href:"./purchases",children:"Purchase Implementation Guide"})," for detailed code examples"]}),"\n",(0,i.jsxs)(e.li,{children:["Check out ",(0,i.jsx)(e.a,{href:"./error-handling",children:"Error Handling Guide"})," for debugging tips"]}),"\n",(0,i.jsxs)(e.li,{children:["See ",(0,i.jsx)(e.a,{href:"../api/",children:"API Reference"})," for detailed method documentation"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}}}]);