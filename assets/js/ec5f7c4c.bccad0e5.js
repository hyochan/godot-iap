"use strict";(globalThis.webpackChunkgodot_iap_docs=globalThis.webpackChunkgodot_iap_docs||[]).push([[63],{1437(e,n,r){r.d(n,{A:()=>t});r(6540);var s=r(7856),i=r(4848);function t({children:e,path:n=""}){return(0,i.jsx)("a",{href:`${s.V}${n}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{navigator.sendBeacon?navigator.sendBeacon(s.I):fetch(s.I,{method:"POST",keepalive:!0}).catch(()=>{})},children:e})}},2824(e,n,r){r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"api/methods/unified-apis","title":"Unified APIs","description":"These cross-platform methods work on both iOS and Android using the type-safe API. For StoreKit/Play-specific helpers, see the iOS Specific and Android Specific sections.","source":"@site/docs/api/methods/unified-apis.md","sourceDirName":"api/methods","slug":"/api/methods/unified-apis","permalink":"/godot-iap/api/methods/unified-apis","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/godot-iap/tree/main/docs/docs/api/methods/unified-apis.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Unified APIs","sidebar_label":"Unified APIs","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Core Methods","permalink":"/godot-iap/api/methods/core-methods"},"next":{"title":"Signals","permalink":"/godot-iap/api/methods/listeners"}}');var i=r(4848),t=r(8453),c=r(5159),o=r(1437);const d={title:"Unified APIs",sidebar_label:"Unified APIs",sidebar_position:2},a="Unified APIs",p={},h=[{value:"Setup",id:"setup",level:2},{value:"init_connection()",id:"init_connection",level:2},{value:"end_connection()",id:"end_connection",level:2},{value:"fetch_products()",id:"fetch_products",level:2},{value:"request_purchase()",id:"request_purchase",level:2},{value:"finish_transaction()",id:"finish_transaction",level:2},{value:"get_available_purchases()",id:"get_available_purchases",level:2},{value:"deep_link_to_subscriptions()",id:"deep_link_to_subscriptions",level:2},{value:"verify_purchase()",id:"verify_purchase",level:2},{value:"Server-Side Verification with IAPKit",id:"server-side-verification-with-iapkit",level:2},{value:"Basic HTTP Verification",id:"basic-http-verification",level:3},{value:"IAPKit Purchase States",id:"iapkit-purchase-states",level:3},{value:"Purchase Interface",id:"purchase-interface",level:2},{value:"Complete Example",id:"complete-example",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"unified-apis",children:"Unified APIs"})}),"\n",(0,i.jsx)(c.A,{}),"\n",(0,i.jsxs)(n.p,{children:["These cross-platform methods work on both iOS and Android using the ",(0,i.jsx)(n.strong,{children:"type-safe API"}),". For StoreKit/Play-specific helpers, see the ",(0,i.jsx)(n.a,{href:"./ios-specific",children:"iOS Specific"})," and ",(0,i.jsx)(n.a,{href:"./android-specific",children:"Android Specific"})," sections."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#init_connection",children:(0,i.jsx)(n.code,{children:"init_connection()"})})," \u2014 Initialize the store connection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#end_connection",children:(0,i.jsx)(n.code,{children:"end_connection()"})})," \u2014 End the store connection and cleanup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#fetch_products",children:(0,i.jsx)(n.code,{children:"fetch_products()"})})," \u2014 Fetch product metadata"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#request_purchase",children:(0,i.jsx)(n.code,{children:"request_purchase()"})})," \u2014 Start a purchase"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#finish_transaction",children:(0,i.jsx)(n.code,{children:"finish_transaction()"})})," \u2014 Complete a transaction after validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#get_available_purchases",children:(0,i.jsx)(n.code,{children:"get_available_purchases()"})})," \u2014 Restore non-consumables and subscriptions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#deep_link_to_subscriptions",children:(0,i.jsx)(n.code,{children:"deep_link_to_subscriptions()"})})," \u2014 Open native subscription management UI"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#verify_purchase",children:(0,i.jsx)(n.code,{children:"verify_purchase()"})})," \u2014 Verify purchase with native OpenIAP implementation"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'extends Node\n\n# Load OpenIAP types for type-safe API\nconst Types = preload("res://addons/godot-iap/types.gd")\n\n# Reference to GodotIapWrapper node (add as child in scene tree)\n@onready var iap = $GodotIapWrapper\n'})}),"\n",(0,i.jsx)(n.h2,{id:"init_connection",children:"init_connection()"}),"\n",(0,i.jsx)(n.p,{children:"Initializes the connection to the store. This method must be called before any other store operations."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func _ready():\n    _setup_signals()\n    _initialize()\n\nfunc _setup_signals():\n    iap.purchase_updated.connect(_on_purchase_updated)\n    iap.purchase_error.connect(_on_purchase_error)\n    iap.products_fetched.connect(_on_products_fetched)\n    iap.connected.connect(_on_connected)\n\nfunc _initialize():\n    # Returns bool - true if connection successful\n    var success = iap.init_connection()\n\n    if success:\n        print("Store connection initialized")\n    else:\n        print("Failed to initialize connection")\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"bool"})," - ",(0,i.jsx)(n.code,{children:"true"})," if connection successful"]}),"\n",(0,i.jsx)(n.h2,{id:"end_connection",children:"end_connection()"}),"\n",(0,i.jsx)(n.p,{children:"Ends the connection to the store and cleans up resources."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func _cleanup():\n    # Returns bool - true if disconnection successful\n    var success = iap.end_connection()\n\n    if success:\n        print("Store connection ended")\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"bool"})," - ",(0,i.jsx)(n.code,{children:"true"})," if disconnection successful"]}),"\n",(0,i.jsx)(n.h2,{id:"fetch_products",children:"fetch_products()"}),"\n",(0,i.jsx)(n.p,{children:"Fetches product information from the store using typed request."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func load_products():\n    # Create typed ProductRequest\n    var request = Types.ProductRequest.new()\n    var skus: Array[String] = ["coins_100", "coins_500", "remove_ads"]\n    request.skus = skus\n    request.type = Types.ProductQueryType.ALL  # or IN_APP, SUBS\n\n    # Returns Array of Types.ProductAndroid or Types.ProductIOS\n    var products = iap.fetch_products(request)\n\n    for product in products:\n        # Access typed properties directly\n        print("Product: ", product.id)\n        print("Price: ", product.display_price)\n        print("Title: ", product.title)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"request"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Types.ProductRequest"})}),(0,i.jsx)(n.td,{children:"Product request with SKUs and type"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Array"})," of ",(0,i.jsx)(n.code,{children:"Types.ProductAndroid"})," (Android) or ",(0,i.jsx)(n.code,{children:"Types.ProductIOS"})," (iOS)"]}),"\n",(0,i.jsxs)(n.admonition,{title:"Using Signals",type:"tip",children:[(0,i.jsxs)(n.p,{children:["Products are also available through the ",(0,i.jsx)(n.code,{children:"products_fetched"})," signal for async handling:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func _ready():\n    iap.products_fetched.connect(_on_products_fetched)\n\nfunc _on_products_fetched(result: Dictionary):\n    if result.has("products"):\n        for product_dict in result["products"]:\n            print("Product: ", product_dict.get("id", ""))\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"request_purchase",children:"request_purchase()"}),"\n",(0,i.jsx)(n.p,{children:"Initiates a purchase request for a product or subscription using typed props."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'# Purchase a product\nfunc buy_product(product_id: String):\n    var props = Types.RequestPurchaseProps.new()\n    props.request = Types.RequestPurchasePropsByPlatforms.new()\n\n    # Android configuration\n    props.request.google = Types.RequestPurchaseAndroidProps.new()\n    var skus: Array[String] = [product_id]\n    props.request.google.skus = skus\n\n    # iOS configuration\n    props.request.apple = Types.RequestPurchaseIOSProps.new()\n    props.request.apple.sku = product_id\n\n    props.type = Types.ProductQueryType.IN_APP\n\n    # Returns Types.PurchaseAndroid, Types.PurchaseIOS, or null\n    var purchase = iap.request_purchase(props)\n\n    if purchase:\n        print("Purchase initiated: ", purchase.product_id)\n    # Purchase result also comes via purchase_updated signal\n\n# Purchase a subscription\nfunc buy_subscription(subscription_id: String, offer_token: String = ""):\n    var props = Types.RequestPurchaseProps.new()\n    props.request = Types.RequestPurchasePropsByPlatforms.new()\n    props.type = Types.ProductQueryType.SUBS\n\n    # Android configuration (offer token required for subscriptions)\n    props.request.google = Types.RequestPurchaseAndroidProps.new()\n    var skus: Array[String] = [subscription_id]\n    props.request.google.skus = skus\n    if offer_token != "":\n        var offers: Array[Types.SubscriptionOfferAndroid] = []\n        var offer = Types.SubscriptionOfferAndroid.new()\n        offer.sku = subscription_id\n        offer.offer_token = offer_token\n        offers.append(offer)\n        props.request.google.subscription_offers = offers\n\n    # iOS configuration\n    props.request.apple = Types.RequestPurchaseIOSProps.new()\n    props.request.apple.sku = subscription_id\n\n    iap.request_purchase(props)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"props"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Types.RequestPurchaseProps"})}),(0,i.jsx)(n.td,{children:"Purchase request with platform-specific options"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Variant"})," - ",(0,i.jsx)(n.code,{children:"Types.PurchaseAndroid"}),", ",(0,i.jsx)(n.code,{children:"Types.PurchaseIOS"}),", or ",(0,i.jsx)(n.code,{children:"null"})]}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"request_purchase"})," initiates the purchase flow. Handle purchase outcomes through the ",(0,i.jsx)(n.code,{children:"purchase_updated"})," and ",(0,i.jsx)(n.code,{children:"purchase_error"})," signals."]})}),"\n",(0,i.jsx)(n.h2,{id:"finish_transaction",children:"finish_transaction()"}),"\n",(0,i.jsx)(n.p,{children:"Completes a purchase transaction. Must be called after successful purchase verification."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func _on_purchase_updated(purchase: Dictionary):\n    # Validate receipt on your server first (recommended)\n    var verified = await verify_on_server(purchase)\n\n    if verified:\n        # Grant purchase to user\n        grant_purchase_to_user(purchase)\n\n        # Finish the transaction using Dictionary convenience method\n        var is_consumable = is_consumable_product(purchase.get("productId", ""))\n        var result = iap.finish_transaction_dict(purchase, is_consumable)\n\n        if result.success:\n            print("Transaction completed")\n\n# Alternative: Using typed PurchaseInput\nfunc finish_with_typed_input(purchase: Dictionary):\n    var purchase_input = Types.PurchaseInput.from_dict(purchase)\n    var is_consumable = true\n    var result = iap.finish_transaction(purchase_input, is_consumable)\n\n    if result.success:\n        print("Transaction finished")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"purchase"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Types.PurchaseInput"})," or ",(0,i.jsx)(n.code,{children:"Dictionary"})]}),(0,i.jsx)(n.td,{children:"The purchase to finish"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"is_consumable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:"Whether the product is consumable"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Types.VoidResult"})," with ",(0,i.jsx)(n.code,{children:"success"})," boolean"]}),"\n",(0,i.jsx)(n.h2,{id:"get_available_purchases",children:"get_available_purchases()"}),"\n",(0,i.jsx)(n.p,{children:"Retrieves available purchases for restoration (non-consumable products and subscriptions)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func restore_purchases():\n    # Returns Array of Types.PurchaseAndroid or Types.PurchaseIOS\n    var purchases = iap.get_available_purchases()\n\n    for purchase in purchases:\n        # Access typed properties\n        print("Product: ", purchase.product_id)\n\n        # Validate and restore each purchase\n        var is_valid = await verify_on_server_typed(purchase)\n        if is_valid:\n            grant_purchase_to_user_typed(purchase)\n\n    print("Purchases restored")\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Array"})," of ",(0,i.jsx)(n.code,{children:"Types.PurchaseAndroid"})," (Android) or ",(0,i.jsx)(n.code,{children:"Types.PurchaseIOS"})," (iOS)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Platform behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"iOS"})," \u2014 Returns active entitlements from StoreKit 2"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Android"})," \u2014 Queries both in-app and subscription purchases, merges results"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"deep_link_to_subscriptions",children:"deep_link_to_subscriptions()"}),"\n",(0,i.jsx)(n.p,{children:"Opens the platform-specific subscription management UI."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func open_subscription_settings():\n    var options = Types.DeepLinkOptions.new()\n\n    if OS.get_name() == "Android":\n        options.package_name_android = "com.yourcompany.game"\n        options.sku_android = "premium_monthly"  # Optional\n\n    iap.deep_link_to_subscriptions(options)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"options"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Types.DeepLinkOptions"})}),(0,i.jsx)(n.td,{children:"Deep link options (optional)"})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"verify_purchase",children:"verify_purchase()"}),"\n",(0,i.jsx)(n.p,{children:"Verifies a purchase using the native OpenIAP implementation. This validates purchases using platform-specific methods."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'func verify(product_id: String, purchase):\n    var props = Types.VerifyPurchaseProps.new()\n\n    if OS.get_name() == "iOS":\n        props.apple = Types.VerifyPurchasePropsIOS.new()\n        props.apple.sku = product_id\n    elif OS.get_name() == "Android":\n        props.google = Types.VerifyPurchasePropsAndroid.new()\n        props.google.sku = product_id\n        props.google.package_name = "com.yourcompany.game"\n        props.google.purchase_token = purchase.purchase_token\n        props.google.access_token = await get_access_token_from_server()\n        props.google.is_sub = false\n\n    # Returns Types.VerifyPurchaseResultIOS or Types.VerifyPurchaseResultAndroid\n    var result = iap.verify_purchase(props)\n\n    if result and result.is_valid:\n        print("Purchase verified!")\n        grant_purchase_to_user_typed(purchase)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"props"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Types.VerifyPurchaseProps"})}),(0,i.jsx)(n.td,{children:"Verification options"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Types.VerifyPurchaseResultIOS"})," or ",(0,i.jsx)(n.code,{children:"Types.VerifyPurchaseResultAndroid"}),", or ",(0,i.jsx)(n.code,{children:"null"})]}),"\n",(0,i.jsxs)(n.p,{children:["For external verification services with additional security, consider using ",(0,i.jsx)(o.A,{children:"IAPKit"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"server-side-verification-with-iapkit",children:"Server-Side Verification with IAPKit"}),"\n",(0,i.jsxs)(n.p,{children:["For production apps, we recommend using ",(0,i.jsx)(o.A,{children:"IAPKit"})," for server-side purchase verification. IAPKit provides:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cross-platform verification"})," for both iOS and Android purchases"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subscription status tracking"})," with renewal detection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fraud prevention"})," with receipt validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Webhook notifications"})," for real-time purchase events"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"basic-http-verification",children:"Basic HTTP Verification"}),"\n",(0,i.jsx)(n.p,{children:"You can call IAPKit's verification API directly from your game or backend server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'# Verify purchase with IAPKit\nfunc verify_with_iapkit(purchase: Dictionary) -> Dictionary:\n    var http = HTTPRequest.new()\n    add_child(http)\n\n    var headers = [\n        "Content-Type: application/json",\n        "Authorization: Bearer YOUR_IAPKIT_API_KEY"\n    ]\n\n    var body = {}\n    if OS.get_name() == "iOS":\n        body = {\n            "apple": {\n                "jws": purchase.get("purchaseToken", "")\n            }\n        }\n    elif OS.get_name() == "Android":\n        body = {\n            "google": {\n                "purchaseToken": purchase.get("purchaseToken", "")\n            }\n        }\n\n    http.request(\n        "https://api.iapkit.com/v1/verify",\n        headers,\n        HTTPClient.METHOD_POST,\n        JSON.stringify(body)\n    )\n\n    var response = await http.request_completed\n    http.queue_free()\n\n    var result = JSON.parse_string(response[3].get_string_from_utf8())\n    return result if result is Dictionary else {}\n\n# Usage in purchase handler\nfunc _on_purchase_updated(purchase: Dictionary):\n    var state = purchase.get("purchaseState", "")\n\n    if state == "purchased" or state == "Purchased":\n        var verification = await verify_with_iapkit(purchase)\n\n        if verification.get("isValid", false):\n            var iapkit_state = verification.get("state", "")\n\n            match iapkit_state:\n                "entitled":\n                    # User is entitled to the product\n                    grant_purchase(purchase.get("productId", ""))\n                "pending":\n                    # Purchase is pending - wait for confirmation\n                    print("Purchase pending")\n                "expired":\n                    # Subscription has expired\n                    revoke_entitlement(purchase.get("productId", ""))\n                "inauthentic":\n                    # Purchase could not be verified - possible fraud\n                    print("Warning: Inauthentic purchase detected")\n\n        # Always finish the transaction\n        var is_consumable = is_consumable_product(purchase.get("productId", ""))\n        iap.finish_transaction_dict(purchase, is_consumable)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"iapkit-purchase-states",children:"IAPKit Purchase States"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Action"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"entitled"})}),(0,i.jsx)(n.td,{children:"User is entitled to the product"}),(0,i.jsx)(n.td,{children:"Grant entitlement"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pending"})}),(0,i.jsx)(n.td,{children:"Purchase is pending"}),(0,i.jsx)(n.td,{children:"Wait for confirmation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"canceled"})}),(0,i.jsx)(n.td,{children:"Purchase was canceled"}),(0,i.jsx)(n.td,{children:"Do not grant"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"expired"})}),(0,i.jsx)(n.td,{children:"Subscription has expired"}),(0,i.jsx)(n.td,{children:"Revoke entitlement"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ready-to-consume"})}),(0,i.jsx)(n.td,{children:"Consumable ready to be consumed"}),(0,i.jsx)(n.td,{children:"Consume and grant"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"consumed"})}),(0,i.jsx)(n.td,{children:"Consumable has been consumed"}),(0,i.jsx)(n.td,{children:"Already processed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"inauthentic"})}),(0,i.jsx)(n.td,{children:"Purchase could not be verified"}),(0,i.jsx)(n.td,{children:"Reject - possible fraud"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"See also:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(o.A,{children:"IAPKit Dashboard"}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.openiap.dev/docs/apis#iapkit-purchase-states",children:"IAPKit Purchase States"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../error-codes",children:"Error Codes Reference"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"purchase-interface",children:"Purchase Interface"}),"\n",(0,i.jsxs)(n.p,{children:["The purchase dictionary structure returned from ",(0,i.jsx)(n.code,{children:"purchase_updated"})," signal:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'# Purchase Dictionary Structure\n{\n    "productId": "coins_100",\n    "transactionId": "1000000123456789",\n    "transactionDate": 1703980800000,\n    "purchaseToken": "...",\n\n    # iOS-specific\n    "originalTransactionDateIOS": 1703980800000,\n    "originalTransactionIdentifierIOS": "1000000123456789",\n    "expirationDateIOS": 1706659200000,\n    "environmentIOS": "Sandbox",\n\n    # Android-specific\n    "purchaseState": "purchased",\n    "isAcknowledgedAndroid": false,\n    "autoRenewingAndroid": true,\n    "packageNameAndroid": "com.yourcompany.game"\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gdscript",children:'extends Node\n\nconst Types = preload("res://addons/godot-iap/types.gd")\n\n@onready var iap = $GodotIapWrapper\n\nvar products: Array = []\n\nfunc _ready():\n    _setup_signals()\n    _initialize()\n\nfunc _setup_signals():\n    iap.purchase_updated.connect(_on_purchase_updated)\n    iap.purchase_error.connect(_on_purchase_error)\n    iap.products_fetched.connect(_on_products_fetched)\n    iap.connected.connect(_on_connected)\n\nfunc _initialize():\n    if iap.init_connection():\n        _load_products()\n\nfunc _load_products():\n    var request = Types.ProductRequest.new()\n    var skus: Array[String] = ["coins_100", "remove_ads"]\n    request.skus = skus\n    request.type = Types.ProductQueryType.ALL\n\n    products = iap.fetch_products(request)\n    for product in products:\n        print("Loaded: ", product.id, " - ", product.display_price)\n\nfunc _on_connected():\n    print("Store connected")\n\nfunc _on_products_fetched(result: Dictionary):\n    # Handle async products fetch (iOS)\n    if result.has("products"):\n        for product_dict in result["products"]:\n            print("Fetched: ", product_dict.get("id", ""))\n\nfunc _on_purchase_updated(purchase: Dictionary):\n    var state = purchase.get("purchaseState", "")\n\n    if state == "purchased" or state == "Purchased":\n        # Verify on server\n        var verified = await verify_on_server(purchase)\n        if verified:\n            grant_purchase(purchase.get("productId", ""))\n\n            # Finish transaction\n            var is_consumable = is_consumable_product(purchase.get("productId", ""))\n            iap.finish_transaction_dict(purchase, is_consumable)\n\nfunc _on_purchase_error(error: Dictionary):\n    var code = error.get("code", "")\n    match code:\n        "USER_CANCELED":\n            print("User canceled")\n        _:\n            print("Error: ", error.get("message", ""))\n\nfunc buy(product_id: String):\n    var props = Types.RequestPurchaseProps.new()\n    props.request = Types.RequestPurchasePropsByPlatforms.new()\n    props.type = Types.ProductQueryType.IN_APP\n\n    props.request.google = Types.RequestPurchaseAndroidProps.new()\n    var skus: Array[String] = [product_id]\n    props.request.google.skus = skus\n\n    props.request.apple = Types.RequestPurchaseIOSProps.new()\n    props.request.apple.sku = product_id\n\n    iap.request_purchase(props)\n\nfunc restore():\n    var purchases = iap.get_available_purchases()\n    for purchase in purchases:\n        grant_purchase(purchase.product_id)\n\nfunc verify_on_server(purchase: Dictionary) -> bool:\n    # Implement server-side verification\n    return true\n\nfunc grant_purchase(product_id: String):\n    # Grant content to user\n    pass\n\nfunc is_consumable_product(product_id: String) -> bool:\n    return product_id in ["coins_100", "coins_500"]\n'})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},5159(e,n,r){r.d(n,{A:()=>c});r(6540);var s=r(6025),i=r(7856),t=r(4848);function c({title:e}){const n=(0,s.Ay)("/img/iapkit-banner.gif"),r=()=>{fetch(i.I,{method:"POST"}).catch(()=>{})};return(0,t.jsxs)("div",{style:{flex:1,marginTop:24,marginBottom:24},children:[(0,t.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:r,children:(0,t.jsx)("img",{src:n,alt:"IAPKit - In-App Purchase Solution",style:{display:"block",margin:"0 auto",objectFit:"contain"}})}),e?(0,t.jsx)("a",{href:i.V,target:"_blank",rel:"noopener noreferrer",onClick:r,style:{display:"block",fontSize:"0.875rem",color:"#666",textAlign:"center",marginTop:"8px",textDecoration:"none"},children:e}):null]})}},7856(e,n,r){r.d(n,{I:()=>i,V:()=>s});const s="https://iapkit.com",i="https://www.hyo.dev/api/ad-banner/cmju2uzzm0000yr9h3dhpflgy"},8453(e,n,r){r.d(n,{R:()=>c,x:()=>o});var s=r(6540);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);